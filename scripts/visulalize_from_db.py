import os

import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns
import sqlite3


def plot_scatter(title, xlabel, ylabel, figsize=(10, 10)):
    # load from the DB
    db_path = os.path.join(os.path.dirname(__file__), '..', 'data', 'db', 'e2index.db')
    conn = sqlite3.connect(db_path)
    df = pd.read_sql('SELECT * FROM E2Index', conn)

    # Crea lo scatterplot con un colore per ogni punto e una legenda
    sns.scatterplot(data=df, x='e2_index', y='h_index', hue='Track', style='Track', s=100, palette='colorblind')
    #sns.regplot(data=df, x='e2_index', y='h_index', scatter=False, color='black')


    correlazione = df['e2_index'].corr(df['h_index'])
    # calcolate correlation with 
    # add the value on top of the regression line
    plt.text(0.7, 0.9, f'Correlation: {correlazione:.2f}', horizontalalignment='center', verticalalignment='center',
             transform=plt.gca().transAxes)

    # Imposta il titolo e le etichette degli assi
    plt.title(title)
    plt.xlabel(xlabel)
    plt.ylabel(ylabel)

    # Mostra il grafico
    plt.show()




def average_per_track():
    db_path = os.path.join(os.path.dirname(__file__), '..', 'data', 'db', 'e2index.db')
    conn = sqlite3.connect(db_path)
    df = pd.read_sql('SELECT * FROM E2Index', conn)

    average_values = df.groupby('Track')[['e2_index', 'h_index']].mean()
    # Crea un grafico a barre delle medie
    average_values.plot.bar()
    # create two different barplots for each index (e2_index and h_index)
    sns.barplot(data=average_values, x='Track', y='e2_index')
    plt.show()
    sns.barplot(data=average_values, x='Track', y='h_index')
    plt.show()

    # Imposta il titolo e le etichette degli assi
    plt.title('Average Explorativity and H-Index per Track')
    plt.xlabel('Track')
    plt.ylabel('Average Value')

    # Mostra il grafico
    plt.show()
  
    pass




if __name__ == "__main__":
    plot_scatter('Distanza media tra i documenti', 'Distanza media', 'h-index')

    average_per_track()